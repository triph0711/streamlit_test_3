<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Audio Recorder</title>
    <script src="https://cdn.jsdelivr.net/npm/recorder-js@0.1.0/dist/recorder.min.js"></script>
</head>
<body>
    <h1>Record Audio</h1>
    <button id="startRecording">Start Recording</button>
    <button id="stopRecording" disabled>Stop Recording</button>
    <br><br>
    <audio id="audioPlayer" controls></audio>

    <script>
        let recorder;
        let audioStream;
        let audioPlayer = document.getElementById('audioPlayer');

        const startRecordingBtn = document.getElementById('startRecording');
        const stopRecordingBtn = document.getElementById('stopRecording');

        // Start recording
        startRecordingBtn.addEventListener('click', async () => {
            try {
                console.log("Requesting microphone access...");
                // Request microphone access
                audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });

                // Initialize Recorder.js
                recorder = new Recorder(audioStream);
                await recorder.start();

                startRecordingBtn.disabled = true;
                stopRecordingBtn.disabled = false;
                console.log("Recording started...");
            } catch (err) {
                console.error("Error accessing microphone: ", err);
                alert("Failed to access microphone. Please check permissions.");
            }
        });

        // Stop recording
        stopRecordingBtn.addEventListener('click', async () => {
            try {
                console.log("Stopping recording...");
                await recorder.stop();
                audioStream.getTracks().forEach(track => track.stop());  // Stop the audio stream
                const audioBlob = recorder.getWAV();
                const audioURL = URL.createObjectURL(audioBlob);

                audioPlayer.src = audioURL;  // Update the audio player with the recorded audio
                stopRecordingBtn.disabled = true;
                startRecordingBtn.disabled = false;
                console.log("Recording stopped and audio saved.");
            } catch (err) {
                console.error("Error stopping the recording: ", err);
                alert("Failed to stop the recording.");
            }
        });
    </script>
</body>
</html>
